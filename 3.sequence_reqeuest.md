sequenceDiagram
    participant User
    participant API
    participant Auth
    participant Search
    participant ImageService
    participant Cache
    participant Storage

    User->>API: Query Request
    API->>Auth: Validate Token
    Auth-->>API: Token Valid
    API->>Search: Process Query
    Search-->>API: Image Metadata
    API->>ImageService: Fetch Image
    ImageService->>Cache: Check Cache
    alt Image in Cache
        Cache-->>ImageService: Return Image
    else Image not in Cache
        ImageService->>Storage: Fetch Image
        Storage-->>ImageService: Return Image
        ImageService->>Cache: Store in Cache
    end
    ImageService-->>API: Return Image
    API-->>User: Send Response